# Docs for the Azure Web Apps Deploy action: https://github.com/Azure/webapps-deploy
# More GitHub Actions for Azure: https://github.com/Azure/actions

name: Build and deploy ASP.Net Core app to Azure Web App - agendamentotcc

on:
  push:
    branches:
      - master
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@master

    - name: Set up .NET Core
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: '5.0.x'

    - name: Build with dotnet
      run: dotnet build --configuration 
      
    - name: Generate deployment package
      run: zip -r deploy.zip . -x '*.git*'  
      
    - name: Deploy to EB
      uses: einaregilsson/beanstalk-deploy@v16
      with:
        aws_access_key: AKIA52242OYR5KA2Y24E
        aws_secret_key: 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
        application_name: backendAPI
        environment_name: Backendapi-env
        version_label: 12345
        region: sa-east-1
        deployment_package: deploy.zip
